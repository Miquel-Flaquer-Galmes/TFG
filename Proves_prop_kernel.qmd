---
title: "Proves_PropagationKernel"
format: html
editor: visual
---

## Grafs

Anem a crear una sèrie de grafs jugueta per poder-los comparar mitjançant el propagation kernel. Ho farem a través de la llibreria igraph. Com aquesta llibreria no té implementats kernels emprarem la llibreria graphkernels per definir el propagationKernel, en primera instància d'una forma molt bàsica, ja que tenim una sola dimensió d'atributs.


```{r, echo=FALSE}
matriu_propagacio <- function(G){
  T <- as_adjacency_matrix(G, sparse = TRUE)
  suma_files <- Matrix::rowSums(T)
  d <- ifelse(suma_files == 0, 1, 0)
  suma_files[suma_files == 0] <- 1
  T_prop <- (T / suma_files) + diag(d)
  return (T_prop)
}
```



```{r, echo=FALSE}
library(graphkernels)
library(Matrix)
library(lsa)

Prop_att_ker <- function(G1, G2, iteracions){
  p1 <- as.matrix(as_tibble(vertex.attributes(G1)))
  p2 <- as.matrix(as_tibble(vertex.attributes(G2)))
  MP1 <- t(matriu_propagacio(G1))
  MP2 <- t(matriu_propagacio(G2))
  dist_cos <- 1 - cosine(as.vector(p1),as.vector(p2))
  for (i in 1:iteracions){
    p1 <- MP1 %*% p1
    p2 <- MP2 %*% p2
    dist_cos <- 1 - cosine(as.vector(p1),as.vector(p2))
  } 
return(dist_cos)
}
  
```



```{r, echo=FALSE}
library(igraph)
library(tidyverse)
adj_1 <- matrix(c(0,1,0,1,0,0, 0,0,1,0,0,0, 0,0,0,0,0,1, 0,0,0,0,0,0, 0,0,0,1,0,1, 0,0,0,0,0,0), nrow = 6, ncol = 6, byrow = TRUE)
g1 <- graph_from_adjacency_matrix(
  adj_1, mode = c("directed")
  ) %>% 
    set_vertex_attr("pesos", value = c(10,16,8,6,10,12))


adj_2 <- matrix(c(0,1,0,1,0,0, 0,0,1,0,0,0, 0,0,0,0,0,1, 0,0,0,0,0,0, 0,0,0,1,0,1, 0,0,0,0,0,0), nrow = 6, ncol = 6, byrow = TRUE)
g2 <- graph_from_adjacency_matrix(
  adj_2, mode = c("directed")
  ) %>% 
    set_vertex_attr("pesos", value = c(5,8,4,3,5,6))

adj_3 <- matrix(c(0,0,0,0,0,0, 1,0,0,0,0,0, 0,1,0,0,0,0, 1,0,0,0,1,0, 0,0,0,0,0,0, 0,0,1,0,1,0), nrow = 6, ncol = 6, byrow = TRUE)
g3 <- graph_from_adjacency_matrix(
  adj_3, mode = c("directed")
  ) %>% 
    set_vertex_attr("pesos", value = c(10,16,8,6,10,12))

adj_4 <- matrix(c(0,1,0,1,0,0, 0,0,1,0,0,0, 0,0,0,0,0,0, 0,0,0,0,0,0, 0,0,0,1,0,1, 0,0,0,0,0,0), nrow = 6, ncol = 6, byrow = TRUE)
g4 <- graph_from_adjacency_matrix(
  adj_4, mode = c("directed")
  ) %>% 
    set_vertex_attr("pesos", value = c(7,2,11,5,13,3))

adj_5 <- matrix(c(0,1,1,0,0,0, 0,0,0,0,0,1, 0,0,0,0,1,1, 0,0,1,0,0,0, 0,0,0,1,0,0, 1,0,0,0,1,0), nrow = 6, ncol = 6, byrow = TRUE)
g5 <- graph_from_adjacency_matrix(
  adj_5, mode = c("directed")
  ) %>% 
    set_vertex_attr("pesos", value = c(1:6))

adj_6 <- matrix(c(0,1,0,0,0,1, 0,0,1,0,0,1, 0,0,0,0,1,1, 0,0,1,0,0,0, 0,0,0,1,0,0, 1,0,0,0,1,0), nrow = 6, ncol = 6, byrow = TRUE)
g6 <- graph_from_adjacency_matrix(
  adj_6, mode = c("directed")
  ) %>% 
    set_vertex_attr("pesos", value = c(12,18,26,26,32,9))

```
